<html>
<head>
  <meta charset="utf8">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Coustard:wght@400;900&family=Oleo+Script:wght@400;700&family=Sedan+SC&display=swap" rel="stylesheet">
  <style>
    button {font-family: 'Sedan SC', serif;font-weight: 800;font-style: normal;}
  </style>
  <title>Genshin Impact soundtract tierlist maker</title>
  <script src="http://code.jquery.com/jquery-1.5.min.js"></script>
  <script src="/socket.io/socket.io.js"></script>
  <script type="text/javascript">
    var sock = new io();
    var tag = document.createElement('script');
    var video = null;

    tag.src = "https://www.youtube.com/iframe_api";
    var firstScriptTag = document.getElementsByTagName('script')[0];
    firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

    var player;
      function onYouTubeIframeAPIReady() {
        player = new YT.Player('youtube-player', {
          height: '360',
          width: '640',
          videoId: video,
          events: {
            'onReady': onPlayerReady,
            'onStateChange': onPlayerStateChange
          }
        });
      }

      function onPlayerReady(event) {
        if (video) player.loadVideoById(`${video}`, 0, "large")
        event.target.playVideo();
      }

      var done = false;
      function onPlayerStateChange(event) {
        console.log(player.getDuration(), player.getCurrentTime());
        if (player.getDuration() > 0 && player.getDuration()-1 < player.getCurrentTime()) {
          sock.send("changeSong");
        }
      }
      function stopVideo() {
        player.stopVideo();
      }


      

    $(document).ready(function () {
      sock.on('message', function (data) {
        var obj = JSON.parse(data);
        if(obj.video) {
          $("#note").text("non décidée");
          if (player.loadVideoById) player.loadVideoById(`${obj.video}`, 0, "large")
          else video = obj.video;
        }
      });
      sock.connect();
      $("#skip").click(function() { sock.send("changeSong"); });
      $("#save").click(function() { sock.send("save"); });
      $("#note1").click(function() { sock.send("note 1"); $("#note").text("1"); });
      $("#note2").click(function() { sock.send("note 2"); $("#note").text("2"); });
      $("#note3").click(function() { sock.send("note 3"); $("#note").text("3"); });
      $("#note4").click(function() { sock.send("note 4"); $("#note").text("4"); });
      $("#note5").click(function() { sock.send("note 5"); $("#note").text("5"); });
      $("#note6").click(function() { sock.send("note 6"); $("#note").text("6"); });
      $("#note7").click(function() { sock.send("note 7"); $("#note").text("7"); });
      $("#note8").click(function() { sock.send("note 8"); $("#note").text("8"); });
      $("#note9").click(function() { sock.send("note 9"); $("#note").text("9"); });
      $("#note10").click(function() { sock.send("note 10"); $("#note").text("10"); });
    });
  </script>
</head>
<body style="background-color: rgb(247, 237, 220); text-align: center;  font-family: 'Sedan SC', serif;font-weight: 400;font-style: normal; color:rgb(235, 231, 223)">
  <div style="position: relative;top:50%;transform: translateY(-50%); background-color: rgb(53, 47, 47);width: 50%;margin:auto;padding: 50px;border-radius: 100px; border: 6px solid rgb(29, 25, 25);box-shadow: 5px 5px 5px #00000050;">
    <h1 style="font-style: normal;">Genshin Impact soundtract tierlist maker</h1>
    <div id="youtube-player" style="width: 80%;"></div>
    <div style="display: flex;gap:20px; justify-content: center;">
      <p><button id="skip">Passer !</button></p>
      <p><button id="save">Sauvegarder !</button></p>
    </div>
    <div style="display: flex;gap:5px; justify-content: center;">
      <p><button id="note1">1</button></p>
      <p><button id="note2">2</button></p>
      <p><button id="note3">3</button></p>
      <p><button id="note4">4</button></p>
      <p><button id="note5">5</button></p>
      <p><button id="note6">6</button></p>
      <p><button id="note7">7</button></p>
      <p><button id="note8">8</button></p>
      <p><button id="note9">9</button></p>
      <p><button id="note10">10</button></p>
    </div>
    <p>Note: <span id="note">non décidée</span></p>
  </div>
</body>
</html>